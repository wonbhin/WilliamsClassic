<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Williams Master Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #0b0e11; 
            --card: #1e2329; 
            --text: #eaecef; 
            --green: #0ecb81; 
            --red: #f6465d; 
            --gold: #f0b90b; 
            --blue: #3b82f6; 
            --input-bg: #2b3139; 
            --gray: #848e9c;
        }
        
        body { 
            background-color: var(--bg); 
            color: var(--text); 
            font-family: 'Noto Sans KR', sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 15px; 
        }
        
        .container { width: 100%; max-width: 500px; display: flex; flex-direction: column; gap: 15px; }

        /* 1. íƒ€ì´ë¨¸ ë°” */
        .timer-bar {
            background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.4);
            color: var(--blue); padding: 10px 15px; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem;
        }
        .timer-val { font-weight: 700; font-size: 1.1rem; letter-spacing: 1px; }

        /* 2. ë©”ì¸ ëŒ€ì‹œë³´ë“œ */
        .card { background-color: var(--card); border-radius: 12px; padding: 25px; border: 1px solid #2b3139; box-shadow: 0 4px 20px rgba(0,0,0,0.3); position: relative; }
        .mono { font-family: 'Roboto Mono', monospace; }

        /* ì½”ì¸ ì„ íƒ í—¤ë” */
        .coin-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #333;
        }
        .coin-symbol { font-size: 2rem; font-weight: 900; color: #fff; letter-spacing: 1px; line-height: 1; }
        .coin-sub { font-size: 0.9rem; color: var(--gray); font-weight: normal; margin-left: 5px; }
        
        .coin-select {
            background: var(--input-bg); color: #fff; border: 1px solid #444;
            padding: 8px 12px; border-radius: 6px; font-weight: bold; 
            font-size: 0.9rem; cursor: pointer; outline: none;
            transition: 0.2s;
        }
        .coin-select:hover { border-color: var(--gray); }

        /* ì¶”ì„¸ ë±ƒì§€ (íˆ´íŒ ì œê±°ë¡œ ë”ìš± ê¹”ë”í•˜ê²Œ) */
        .badge-container { 
            display: flex; 
            justify-content: center; 
            margin-bottom: 20px; 
        }
        .badge { 
            display: block; 
            padding: 8px 20px; /* ì¢Œìš° íŒ¨ë”© ì‚´ì§ ì¦ê°€ */
            border-radius: 6px; 
            font-weight: 800; 
            font-size: 1rem; 
            letter-spacing: 1px; 
            text-transform: uppercase; 
        }

        .trend-up { background: rgba(14, 203, 129, 0.15); color: var(--green); border: 1px solid var(--green); box-shadow: 0 0 15px rgba(14, 203, 129, 0.2); }
        .trend-down { background: rgba(246, 70, 93, 0.15); color: var(--red); border: 1px solid var(--red); box-shadow: 0 0 15px rgba(246, 70, 93, 0.2); }
        .trend-wait { background: #2b3139; color: var(--gray); border: 1px solid #444; }

        /* ê°€ê²© ì •ë³´ */
        .price-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #333; }
        .price-item { display: flex; flex-direction: column; }
        .price-label { font-size: 0.8rem; color: var(--gray); margin-bottom: 4px; display: flex; align-items: center; gap: 4px; }
        .price-val { font-size: 1.4rem; font-weight: 700; }
        .ma-val { font-size: 1.1rem; color: var(--gold); }

        .action-box { text-align: center; padding: 20px; border-radius: 8px; background: #13161a; border: 2px solid #333; transition: 0.3s; }
        .action-label { color: var(--gray); font-size: 0.9rem; margin-bottom: 5px; display: flex; justify-content: center; align-items: center; gap: 5px; }
        .target-price { font-size: 2.4rem; font-weight: 700; letter-spacing: 1px; margin: 5px 0; }
        .sl-info { color: var(--red); font-weight: bold; font-size: 1rem; margin-top: 10px; }
        
        /* 3. ìê¸ˆ ê´€ë¦¬ & ì„¤ì • */
        .settings-card { background: #161a1e; border: 1px solid #333; border-radius: 10px; padding: 15px; font-size: 0.9rem; }
        .input-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .input-label { display: flex; align-items: center; gap: 5px; } 
        
        .basic-input { background: var(--input-bg); color: #fff; border: 1px solid #444; padding: 6px; border-radius: 4px; font-weight: bold; text-align: center; font-family: 'Roboto Mono'; width: 70px; }
        
        .risk-result { background: #000; padding: 12px; border-radius: 6px; text-align: center; margin-top: 10px; border: 1px solid #444; }
        .risk-val { font-size: 1.3rem; font-weight: bold; color: var(--gold); display: block; margin-top: 5px; }

        /* 4. ë©˜íƒˆ ê´€ë¦¬ */
        .mind-card { 
            margin-top: 10px; padding: 20px; border-radius: 10px; 
            background: linear-gradient(145deg, #1a1d21, #131518);
            border-left: 4px solid var(--gold);
            color: #ccc; line-height: 1.6; font-size: 0.9rem;
        }
        .mind-title { font-weight: bold; color: #fff; margin-bottom: 10px; font-size: 1rem; display: block; }
        .quote { font-style: italic; color: var(--gray); margin-top: 10px; display: block; font-size: 0.85rem; }

        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .time-setting-row { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #333; }
        .toggle-switch { position: relative; display: inline-block; width: 46px; height: 24px; vertical-align: middle; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #363c45; transition: .4s; border-radius: 34px; border: 1px solid #444; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        input:checked + .slider { background-color: var(--blue); border-color: var(--blue); }
        input:checked + .slider:before { transform: translateX(22px); }
        .toggle-label { font-size: 0.9rem; color: #fff; margin-right: 10px; font-weight: 500; vertical-align: middle; display: flex; align-items: center; gap: 5px; }
        .sub-text { font-size: 0.75rem; color: var(--gray); margin-left: 5px; }

        /* íˆ´íŒ ì•„ì´ì½˜ & ìŠ¤íƒ€ì¼ */
        .help-icon {
            display: inline-flex; align-items: center; justify-content: center;
            width: 15px; height: 15px; border-radius: 50%;
            background-color: #333; color: #888; font-size: 10px; font-weight: bold;
            cursor: help; border: 1px solid #444; position: relative; transition: 0.2s;
        }
        .help-icon:hover { background-color: var(--blue); color: #fff; border-color: var(--blue); }

        .help-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95); color: #fff; padding: 10px 12px; border-radius: 6px;
            font-size: 0.8rem; white-space: pre-wrap; width: max-content; max-width: 220px;
            z-index: 999; box-shadow: 0 5px 15px rgba(0,0,0,0.5); border: 1px solid #444;
            line-height: 1.4; font-weight: normal; pointer-events: none; text-align: left;
        }
        .help-icon:hover::before {
            content: ""; position: absolute; bottom: 80%; left: 50%; transform: translateX(-50%);
            border: 5px solid transparent; border-top-color: #444; z-index: 999;
        }

        .blink { animation: blinker 1.5s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

    </style>
</head>
<body>

<div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 style="margin:0;">ğŸ›ï¸ Williams Master</h2>
        <div class="mono" style="font-size:0.75rem; color:var(--gray);">v10.1 Minimal</div>
    </div>

    <div class="timer-bar">
        <div style="display:flex; align-items:center; gap:5px;">
            <span>â³ 09:00 ì²­ì‚°ê¹Œì§€</span>
            <span class="help-icon" data-tooltip="ì¥ ë§ˆê°(ë¦¬ì…‹) ì‹œê°„ì…ë‹ˆë‹¤.&#10;ì´ë•Œ ë³´ìœ  ì¤‘ì¸ í¬ì§€ì…˜ì„ ì „ëŸ‰ ë§¤ë„í•˜ì„¸ìš”.">?</span>
        </div>
        <span id="countdown" class="timer-val mono">--:--:--</span>
    </div>

    <div class="card">
        <div class="coin-header">
            <div>
                <div id="coinSymbol" class="coin-symbol">BTC</div>
                <div class="coin-sub mono">/ USDT</div>
            </div>
            <select id="coinSelect" class="coin-select" onchange="resetData()">
                <option value="BTCUSDT">Bitcoin</option>
                <option value="ETHUSDT">Ethereum</option>
                <option value="SOLUSDT">Solana</option>
                <option value="XRPUSDT">Ripple</option>
            </select>
        </div>

        <div class="badge-container">
            <div id="trendBadge" class="badge trend-wait blink">
                ANALYZING...
            </div>
        </div>

        <div class="price-row mono">
            <div class="price-item">
                <span class="price-label">Current Price</span>
                <span id="curPrice" class="price-val">---</span>
            </div>
            <div class="price-item" style="text-align:right;">
                <span class="price-label">
                    20MA (Trend)
                    <span class="help-icon" data-tooltip="ì§€ë‚œ 20ì¼ê°„ì˜ í‰ê·  ê°€ê²©ì…ë‹ˆë‹¤.&#10;í˜„ì¬ê°€ê°€ ì´ ìœ„ì— ìˆìœ¼ë©´ ìƒìŠ¹ì¥(Bull)ì…ë‹ˆë‹¤.">?</span>
                </span>
                <span id="maPrice" class="ma-val">---</span>
            </div>
        </div>

        <div id="actionBox" class="action-box">
            <div id="actionTitle" class="action-label">
                ì˜¤ëŠ˜ì˜ ì§„ì… ëª©í‘œê°€
                <span class="help-icon" data-tooltip="ì˜¤ëŠ˜ ì´ ê°€ê²©ì— ë„ë‹¬í•˜ë©´ ì¶”ì„¸ê°€ í„°ì§„ ê²ƒì…ë‹ˆë‹¤.&#10;ê±°ë˜ì†Œ ì•±ì—ì„œ 'ì˜ˆì•½ ë§¤ìˆ˜(Stop Market)'ë¥¼ ê±¸ì–´ë‘ì„¸ìš”.">?</span>
            </div>
            <div id="targetPrice" class="target-price mono">---</div>
            <div id="statusMsg" style="font-size:0.9rem; font-weight:bold; color:#666;">ë°ì´í„° ìˆ˜ì‹  ì¤‘...</div>
        </div>

        <div style="text-align:center; margin-top:20px;">
            <div style="font-size:0.8rem; color:var(--gray); display:flex; justify-content:center; align-items:center; gap:5px;">
                <span>â–¼ STOP LOSS (ìë™ ì†ì ˆ ì˜ˆì•½ í•„ìˆ˜)</span>
                <span class="help-icon" data-tooltip="ì§„ì…ê³¼ ë™ì‹œì— ì„¸íŒ…í•´ì•¼ í•˜ëŠ” ì•ˆì „ë²¨íŠ¸ì…ë‹ˆë‹¤.&#10;ì´ ê°€ê²©ì´ ì˜¤ë©´ ë¯¸ë ¨ ì—†ì´ ì†ì ˆí•˜ì„¸ìš”.">?</span>
            </div>
            <div id="stopPrice" class="sl-info mono">---</div>
        </div>
    </div>

    <div class="settings-card">
        <div style="font-weight:bold; color:#fff; margin-bottom:10px;">âš™ï¸ ì„¤ì • ë° ìê¸ˆ ê´€ë¦¬</div>
        
        <div class="input-row">
            <div class="input-label">
                ë…¸ì´ì¦ˆ ë¹„ìœ¨ (K)
                <span class="help-icon" data-tooltip="ëŒíŒŒ ê¸°ì¤€ì„ ì •í•˜ëŠ” ë¯¼ê°ë„ì…ë‹ˆë‹¤.&#10;0.5: í‘œì¤€ (ì¶”ì²œ)&#10;0.4: ê³µê²©ì  (ìì£¼ ì§„ì…)&#10;0.6: ë³´ìˆ˜ì  (ì‹ ì¤‘ ì§„ì…)">?</span>
            </div>
            <input type="number" id="kInput" value="0.5" step="0.1" class="basic-input" onchange="updateUI()">
        </div>
        
        <hr style="border-color:#333; margin:10px 0;">

        <div class="input-row">
            <div class="input-label">
                ë‚´ ì¦ê±°ê¸ˆ (Total)
                <span class="help-icon" data-tooltip="ì„ ë¬¼ ì§€ê°‘ì— ìˆëŠ” ì´ ìì‚°(USDT)ì…ë‹ˆë‹¤.&#10;ì •í™•í•œ ë¦¬ìŠ¤í¬ ê³„ì‚°ì„ ìœ„í•´ ì…ë ¥í•˜ì„¸ìš”.">?</span>
            </div>
            <input type="number" id="capital" placeholder="$1000" class="basic-input" oninput="calcRisk()">
        </div>
        <div class="input-row">
            <div class="input-label">
                í—ˆìš© ì†ì‹¤ (Risk %)
                <span class="help-icon" data-tooltip="í•œ ë²ˆ ì†ì ˆí•  ë•Œ ë‚´ ì „ì²´ ìì‚°ì—ì„œ&#10;ìƒì–´ë„ ë˜ëŠ” ë¹„ìœ¨ì…ë‹ˆë‹¤. (2% ì¶”ì²œ)">?</span>
            </div>
            <input type="number" id="riskPer" value="2" step="0.5" class="basic-input" oninput="calcRisk()">
        </div>
        <div class="input-row">
            <span>ë ˆë²„ë¦¬ì§€ (Lev)</span>
            <input type="number" id="leverage" value="5" class="basic-input" oninput="calcRisk()">
        </div>

        <div class="risk-result">
            <div style="display:flex; justify-content:center; align-items:center; gap:5px; font-size:0.8rem; color:var(--gray);">
                1íšŒ ì§„ì… ì‹œ íˆ¬ì… ê¸ˆì•¡ (Cost)
                <span class="help-icon" data-tooltip="ì—¬ê¸° ë‚˜ì˜¨ ê¸ˆì•¡ë§Œí¼ë§Œ ì£¼ë¬¸ì°½ì˜ [Cost]ì— ì…ë ¥í•˜ì„¸ìš”.&#10;ë ˆë²„ë¦¬ì§€ë¥¼ ì¨ë„ ì•ˆì „í•˜ê²Œ ìì‚°ì„ ì§€í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.">?</span>
            </div>
            <span id="recMargin" class="risk-val mono">--- USDT</span>
        </div>

        <div class="time-setting-row">
            <div style="display:flex; align-items:center;">
                <span class="toggle-label">
                    ì„œë¨¸íƒ€ì„ <span class="sub-text">(-1h)</span>
                    <span class="help-icon" data-tooltip="ë¯¸êµ­ ì¦ì‹œ ì„œë¨¸íƒ€ì„ ê¸°ê°„ì—ëŠ”&#10;ë§ˆê° ì‹œê°„ì´ 1ì‹œê°„ ë‹¹ê²¨ì§‘ë‹ˆë‹¤.">?</span>
                </span>
                <label class="toggle-switch">
                    <input type="checkbox" id="dstCheck" onchange="updateTimer()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div style="display:flex; align-items:center; gap:5px; font-size:0.9rem; color:#ccc;">
                <span style="display:flex; align-items:center; gap:4px;">
                    ë§ˆê°: <span class="help-icon" data-tooltip="ë³¸ì¸ì˜ ìƒí™œ íŒ¨í„´ì— ë§ì¶°&#10;í•˜ë£¨ ë§¤ë§¤ë¥¼ ì¢…ë£Œí•  ì‹œê°„ì„ ì„¤ì •í•˜ì„¸ìš”. (ê¸°ë³¸ 9ì‹œ)">?</span>
                </span>
                <input type="number" id="resetHour" value="9" class="basic-input" style="width:35px; padding:4px;" onchange="updateTimer()">
                <span>ì‹œ</span>
            </div>
        </div>
    </div>

    <div class="mind-card">
        <span class="mind-title">ğŸ§˜ ë˜ë¦¬ ìœŒë¦¬ì—„ìŠ¤ì˜ íˆ¬ì ì›ì¹™</span>
        <ul>
            <li><b>ìµì ˆì€ ì—†ë‹¤:</b> "ì¥ì¤‘ì— 10% ì˜¬ëë‹¤ê³  íŒ”ì§€ ë§ˆë¼. ì˜¤ëŠ˜ í„°ì§„ ì¶”ì„¸ëŠ” ë‚´ì¼ ì•„ì¹¨ 9ì‹œê¹Œì§€ ëê¹Œì§€ ë°œë¼ë¨¹ì–´ë¼."</li>
            <li><b>ì†ì ˆì€ ìƒëª…ì´ë‹¤:</b> "ì†ì ˆê°€ì— ë„ë‹¬í•˜ë©´ ê¸°ê³„ì²˜ëŸ¼ ì˜ë¼ë¼. ê¸°ë„ ë§¤ë§¤ëŠ” íŒŒì‚°ì˜ ì§€ë¦„ê¸¸ì´ë‹¤."</li>
            <li><b>ìê¸ˆ ê´€ë¦¬:</b> "í•œ ë²ˆì˜ ê±°ë˜ì— ì „ ì¬ì‚°ì˜ 2% ì´ìƒì„ ê±¸ì§€ ë§ˆë¼. ê·¸ë˜ì•¼ 10ë²ˆ ì—°ì† ì ¸ë„ ì‚´ì•„ë‚¨ì•„ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤."</li>
        </ul>
        <span class="quote">"íˆ¬ìëŠ” IQê°€ ì•„ë‹ˆë¼, <b>ì›ì¹™ì„ ì§€í‚¤ëŠ” ì¸ë‚´ì‹¬</b>ì˜ ì‹¸ì›€ì´ë‹¤."</span>
    </div>
</div>

<script>
    let market = { current: 0, open: 0, range: 0, ma20: 0 };
    let strategy = { entry: 0, stop: 0, direction: '' };
    let precision = 1;

    resetData();
    setInterval(fetchData, 2000); 
    setInterval(updateTimer, 1000); 
    updateTimer();

    function resetData() {
        const select = document.getElementById('coinSelect');
        const symbolCode = select.value.replace('USDT', '');
        document.getElementById('coinSymbol').innerText = symbolCode;
        
        document.getElementById('trendBadge').innerText = "ANALYZING...";
        document.getElementById('targetPrice').innerText = "---";
        fetchData();
    }

    async function fetchData() {
        try {
            const symbol = document.getElementById('coinSelect').value;
            if(symbol.startsWith('BTC')) precision = 1;
            else if(symbol.startsWith('XRP')) precision = 4;
            else precision = 2;

            const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&limit=25`);
            const data = await res.json();
            
            if(!data || data.length < 25) throw new Error("Data Error");

            const today = data[data.length - 1]; 
            const prev = data[data.length - 2]; 

            market.current = parseFloat(today[4]); 
            market.open = parseFloat(today[1]);    
            market.range = parseFloat(prev[2]) - parseFloat(prev[3]); 

            let sum = 0;
            for(let i = data.length - 21; i < data.length - 1; i++) { 
                sum += parseFloat(data[i][4]); 
            }
            market.ma20 = sum / 20;

            updateUI();
        } catch(e) { 
            console.error(e);
            document.getElementById('statusMsg').innerText = "ì—°ê²° ì¬ì‹œë„ ì¤‘...";
        }
    }

    function updateUI() {
        if(market.current === 0) return;

        const k = parseFloat(document.getElementById('kInput').value);
        const badge = document.getElementById('trendBadge');
        const box = document.getElementById('actionBox');
        const title = document.getElementById('actionTitle');
        const target = document.getElementById('targetPrice');
        const stop = document.getElementById('stopPrice');
        const msg = document.getElementById('statusMsg');

        document.getElementById('curPrice').innerText = market.current.toFixed(precision);
        document.getElementById('maPrice').innerText = market.ma20.toFixed(precision);

        if (market.current > market.ma20) {
            strategy.direction = 'LONG';
            strategy.entry = market.open + (market.range * k);
            strategy.stop = strategy.entry - (market.range * 0.5);
            
            badge.className = "badge trend-up";
            badge.innerText = "â–² TREND: ONLY LONG";
            title.innerHTML = `LONG ENTRY PRICE <span class="help-icon" data-tooltip="ì˜¤ëŠ˜ ì´ ê°€ê²©ì— ë„ë‹¬í•˜ë©´ ì¶”ì„¸ê°€ í„°ì§„ ê²ƒì…ë‹ˆë‹¤.&#10;ê±°ë˜ì†Œ ì•±ì—ì„œ 'ì˜ˆì•½ ë§¤ìˆ˜(Stop Market)'ë¥¼ ê±¸ì–´ë‘ì„¸ìš”.">?</span>`;
            target.style.color = "var(--green)";
            stop.innerText = strategy.stop.toFixed(precision);
            box.style.borderColor = "var(--green)";

            if(market.current >= strategy.entry) {
                msg.innerText = "ğŸš€ ì§„ì… ì²´ê²° ì™„ë£Œ (HOLD)";
                msg.style.color = "var(--green)";
                box.style.background = "rgba(14, 203, 129, 0.1)";
            } else {
                msg.innerText = "ëª©í‘œê°€ ë„ë‹¬ ëŒ€ê¸° ì¤‘...";
                msg.style.color = "#666";
                box.style.background = "#13161a";
            }
        } else {
            strategy.direction = 'SHORT';
            strategy.entry = market.open - (market.range * k);
            strategy.stop = strategy.entry + (market.range * 0.5);
            
            badge.className = "badge trend-down";
            badge.innerText = "â–¼ TREND: ONLY SHORT";
            title.innerHTML = `SHORT ENTRY PRICE <span class="help-icon" data-tooltip="ì˜¤ëŠ˜ ì´ ê°€ê²©ì— ë„ë‹¬í•˜ë©´ ì¶”ì„¸ê°€ í„°ì§„ ê²ƒì…ë‹ˆë‹¤.&#10;ê±°ë˜ì†Œ ì•±ì—ì„œ 'ì˜ˆì•½ ë§¤ìˆ˜(Stop Market)'ë¥¼ ê±¸ì–´ë‘ì„¸ìš”.">?</span>`;
            target.style.color = "var(--red)";
            stop.innerText = strategy.stop.toFixed(precision);
            box.style.borderColor = "var(--red)";

            if(market.current <= strategy.entry) {
                msg.innerText = "ğŸš€ ì§„ì… ì²´ê²° ì™„ë£Œ (HOLD)";
                msg.style.color = "var(--red)";
                box.style.background = "rgba(246, 70, 93, 0.1)";
            } else {
                msg.innerText = "ëª©í‘œê°€ ë„ë‹¬ ëŒ€ê¸° ì¤‘...";
                msg.style.color = "#666";
                box.style.background = "#13161a";
            }
        }
        
        target.innerText = strategy.entry.toFixed(precision);
        calcRisk();
    }

    function calcRisk() {
        const capital = parseFloat(document.getElementById('capital').value);
        const riskPer = parseFloat(document.getElementById('riskPer').value) / 100;
        const leverage = parseFloat(document.getElementById('leverage').value);

        if (!capital || !strategy.entry) return;

        const priceDiff = Math.abs(strategy.entry - strategy.stop);
        const slPercent = priceDiff / strategy.entry;
        
        let riskAmount = capital * riskPer;
        let positionSize = riskAmount / slPercent;
        let requiredMargin = positionSize / leverage;

        if (requiredMargin > capital) requiredMargin = capital;

        const marginEl = document.getElementById('recMargin');
        marginEl.innerText = Math.floor(requiredMargin).toLocaleString() + " USDT";
        
        if(requiredMargin >= capital * 0.9) marginEl.style.color = "var(--red)";
        else marginEl.style.color = "var(--gold)";
    }

    function updateTimer() {
        const now = new Date();
        let h = parseInt(document.getElementById('resetHour').value);
        if(document.getElementById('dstCheck').checked) h -= 1;
        if(h < 0) h = 23;

        let target = new Date(now);
        target.setHours(h, 0, 0, 0);
        if (now > target) target.setDate(target.getDate() + 1);

        const diff = target - now;
        const hh = Math.floor(diff / (1000 * 60 * 60));
        const mm = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const ss = Math.floor((diff % (1000 * 60)) / 1000);

        document.getElementById('countdown').innerText = 
            `${hh < 10 ? '0'+hh : hh}:${mm < 10 ? '0'+mm : mm}:${ss < 10 ? '0'+ss : ss}`;
    }
</script>
</body>
</html>
